{% extends "base.html" %}

{% block content %}
<div class="relative min-h-screen">
    {# Course Content Section #}
    <div class="mr-[350px] p-6 bg-primary-bg-color min-h-screen">
        <div class="course-content">
            {% block course_content %}{% endblock %}
        </div>
    </div>

    {# Chat Panel #}
    <div class="fixed top-[64px] right-0 bottom-0 w-[350px] bg-[#0E1428] shadow-xl flex flex-col">
        {# Chat Header #}
        <div class="px-4 py-3 bg-[#172044] border-b border-gray-700">
            <h2 class="text-lg font-semibold text-white">AI Assistant</h2>
        </div>
        
        {# Messages Container #}
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 flex flex-col gap-4 pb-2">
            {% for message in chat_messages %}
                {% if message.is_user %}
                    <div class="self-end max-w-[75%]">
                        <div style="background-color: #2C3E50;" class="rounded-lg shadow-sm">
                            <div class="p-3">
                                <p class="text-white text-[15px]">{{ message.content }}</p>
                            </div>
                            <div class="px-3 py-1 border-t border-[#34495E] text-right">
                                <span class="text-gray-300 text-xs">You</span>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="self-start max-w-[75%]">
                        <div style="background-color: #1A2636;" class="rounded-lg shadow-sm">
                            <div class="p-3">
                                <p class="text-white text-[15px]">{{ message.content }}</p>
                            </div>
                            <div class="px-3 py-1 border-t border-[#2C3E50] text-left">
                                <span class="text-gray-300 text-xs">AI Assistant</span>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        {# Full Width Input Area with Equal Height Button #}
        <div class="bg-[#172044] border-t border-gray-700 w-full">
            <form method="POST" action="{% url 'course_chat' course.id %}" class="flex w-full">
                {% csrf_token %}
                <textarea 
                    name="message" 
                    rows="5"
                    class="flex-1 rounded-none bg-[#1A2636] text-white p-3 border-r border-[#2C3E50] focus:outline-none focus:border-[#34495E] transition-all duration-300 placeholder-gray-400 resize-none"
                    placeholder="Message AI Assistant..."
                    required
                ></textarea>
                <button type="submit" 
                        class="bg-[#2C3E50] text-white px-8 hover:bg-[#34495E] transition-duration-300">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    #chat-messages::-webkit-scrollbar {
        width: 6px;
    }
    
    #chat-messages::-webkit-scrollbar-track {
        background: #0E1428;
    }
    
    #chat-messages::-webkit-scrollbar-thumb {
        background: #2C3E50;
        border-radius: 3px;
    }

    textarea::-webkit-scrollbar {
        width: 6px;
    }
    
    textarea::-webkit-scrollbar-track {
        background: #0E1428;
    }
    
    textarea::-webkit-scrollbar-thumb {
        background: #2C3E50;
        border-radius: 3px;
    }
</style>

<script>
    // Auto-scroll to bottom of messages
    const chatMessages = document.getElementById('chat-messages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
</script>
{% endblock %}
